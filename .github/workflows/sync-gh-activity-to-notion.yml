name: Sync my GitHub activity to Notion

on:
  schedule:
    - cron: "0 0 * * *" # daily at midnight UTC
  workflow_dispatch:
    inputs:
      date_range:
        description: "Number of days to sync (default: 7)"
        required: false
        default: "7"
        type: string

permissions:
  contents: read

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install requests

      - name: Run sync
        env:
          GH_TOKEN: ${{ secrets.NOTION_SEARCH_GH_TOKEN }}
          NOTION_API_KEY: ${{ secrets.NOTION_GH_ACTIVITY_API_KEY }}
          NOTION_DATABASE_ID: ${{ secrets.NOTION_GH_ACTIVITY_DATABASE_ID }}
          GH_USERNAME: nstarman
        run: |
          python scripts/sync_my_activity_to_notion.py
